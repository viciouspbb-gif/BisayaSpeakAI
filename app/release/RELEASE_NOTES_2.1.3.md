# リリースノート - バージョン 2.1.3 (31)

**リリース日**: 2024年12月7日

## 🔒 セキュリティアップデート（重要）

### reCAPTCHA Enterprise セキュリティ脆弱性対応

Google reCAPTCHA Enterprise for Mobileに発見された重大なセキュリティ脆弱性に対応しました。

**対応内容**:
- reCAPTCHA SDK: 18.1.2 → **18.6.1** ✅
- Firebase BOM: 32.7.0 → **33.7.0**
- Google Play Services Auth: 20.7.0 → **21.2.0**

**参考**: [Google reCAPTCHA Deprecation Policy](https://cloud.google.com/recaptcha/docs/deprecation-policy-mobile)

## ✨ 機能改善

### 広告ロジックの統一

全ての練習モード（リスニング、クイズ、発音練習など）の広告表示ロジックを統一しました。

**新しいルール**:
- ✅ 1セット完了 = 1回広告（必ず表示）
- ✅ 中断時 = 1回広告（必ず表示）
- ✅ より一貫性のあるユーザー体験

**削除された旧仕様**:
- ❌ 10回連続正解で広告
- ❌ 2回ミスで広告
- ❌ 3回Try Againで広告
- ❌ 2回Perfectで広告

**メリット**:
- シンプルで分かりやすい広告表示
- 予測可能なユーザー体験
- コードの保守性向上

## 📝 技術的な変更

### 新規追加
- `PracticeSessionManager`: 全練習モード共通の広告管理クラス
- セキュリティドキュメント: `docs/SECURITY_UPDATE_RECAPTCHA.md`
- 広告ロジック仕様書: `docs/AD_LOGIC_UNIFIED_SPEC.md`

### 修正されたファイル
- `ListeningViewModel.kt`: 広告ロジック統一
- `ListeningScreen.kt`: セッション管理統合
- `PracticeQuizScreen.kt`: 広告ロジック簡素化
- `QuizScreen.kt`: セッション管理統合
- `RecordingScreen.kt`: セッション管理統合

## 🐛 バグ修正

- PracticeQuizScreenの未使用変数参照を削除
- 広告表示の重複を防止

## 📊 ビルド情報

- **versionCode**: 31
- **versionName**: 2.1.3
- **ビルドファイル**: `app-release-2.1.3.aab`
- **ビルド日時**: 2024年12月7日
- **ビルドステータス**: ✅ 成功

## 🎯 影響範囲

### ユーザーへの影響
- ✅ セキュリティ強化（重要）
- ✅ より予測可能な広告表示
- ✅ 機能への影響なし

### 開発者への影響
- ✅ コードの保守性向上
- ✅ 統一されたアーキテクチャ
- ✅ 拡張性の向上

## 📱 動作確認済み環境

- Android 7.0 (API 24) 以上
- 推奨: Android 10.0 (API 29) 以上

## 🚀 リリース手順

### Google Play Console

1. **アップロード**
   - ファイル: `app/release/release/app-release-2.1.3.aab`
   - トラック: 本番環境

2. **リリースノート（日本語）**
   ```
   バージョン 2.1.3
   
   【重要なセキュリティアップデート】
   ・reCAPTCHA Enterpriseを最新版に更新し、セキュリティを強化しました
   
   【機能改善】
   ・全練習モードの広告表示を統一し、より分かりやすくしました
   ・「1セット完了 = 1回広告」のシンプルなルールに変更
   
   【技術的な改善】
   ・依存関係の更新
   ・コードの最適化
   ```

3. **段階的リリース推奨**
   - Phase 1: 10% (24時間)
   - Phase 2: 50% (24時間)
   - Phase 3: 100%

4. **モニタリング項目**
   - クラッシュ率
   - ANR率
   - ユーザーレビュー
   - セキュリティアラート

## ⚠️ 注意事項

### 緊急度
- **高**: Googleが強く推奨するセキュリティアップデート
- できるだけ早くリリースすることを推奨

### 互換性
- 既存ユーザーへの影響なし
- データの移行不要
- 自動アップデート対応

## 📚 関連ドキュメント

- [セキュリティアップデート詳細](../docs/SECURITY_UPDATE_RECAPTCHA.md)
- [広告ロジック統一仕様](../docs/AD_LOGIC_UNIFIED_SPEC.md)

## 🔄 次のバージョン予定

### 2.1.4 (予定)
- パフォーマンス最適化
- UI/UX改善
- 新機能の追加検討

---

## チェックリスト

リリース前の確認事項:

- [x] ビルド成功
- [x] AABファイル生成確認
- [x] バージョン番号更新
- [x] リリースノート作成
- [ ] Google Play Consoleにアップロード
- [ ] 段階的リリース設定
- [ ] モニタリング設定

---

**ビルド担当**: Cascade AI  
**レビュー**: 必要  
**承認**: 必要
