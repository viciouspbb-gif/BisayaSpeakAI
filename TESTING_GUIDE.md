# Bisaya Speak AI - 最終検証ガイド

商用リリース前の最終テストガイドです。

## 🎯 フェーズA: 最終検証

### 1. AdMob動作検証

#### 目的
収益化戦略が計画通りに機能することを確認

#### テスト環境
- **テストモード**: Google提供のテスト広告IDを使用
- **本番モード**: 実際の広告ユニットIDで検証（承認後）

#### 検証項目

##### 1.1 バナー広告の動作確認

**テスト手順**:
1. アプリを起動
2. レベル選択画面で任意のレベルを選択
3. 練習画面に遷移
4. 画面下部にバナー広告が表示されることを確認

**確認ポイント**:
- ✅ バナー広告が画面下部に表示される
- ✅ 広告のサイズが適切（320x50）
- ✅ 学習コンテンツの表示を妨げない
- ✅ スクロール時も広告が固定表示される
- ✅ 広告のロード時間が3秒以内

**期待される動作**:
```
練習画面表示
↓
バナー広告ロード開始（0-1秒）
↓
バナー広告表示（1-3秒）
↓
常時表示（ユーザーが画面を離れるまで）
```

**収益予測**:
- インプレッション: 1回/セッション
- eCPM: $0.50-$1.00
- 予想収益: $0.0005-$0.001/セッション

##### 1.2 インタースティシャル広告の動作確認

**テスト手順**:
1. 練習画面で学習コンテンツを選択
2. 録音画面で音声を録音
3. 「発音を診断」ボタンをタップ
4. インタースティシャル広告が表示されることを確認
5. 広告を閉じる（5秒後にスキップ可能）
6. 診断結果画面に遷移することを確認

**確認ポイント**:
- ✅ 診断ボタン押下後、即座に広告が表示される
- ✅ 広告表示中にバックグラウンドで診断処理が実行される
- ✅ 広告を閉じた後、スムーズに結果画面に遷移
- ✅ 広告が表示されない場合でも診断処理は継続
- ✅ 次回のために広告が自動的にプリロードされる

**タイミング図**:
```
診断ボタン押下
↓
インタースティシャル広告表示（即座）
↓ (並行処理)
├─ 広告表示（5-10秒）
└─ Python APIで診断処理（2-5秒）
↓
広告終了
↓
結果画面表示
↓
次の広告をプリロード（バックグラウンド）
```

**収益予測**:
- インプレッション: 5回/ユーザー/日
- eCPM: $5.00-$10.00
- 予想収益: $0.025-$0.05/ユーザー/日

##### 1.3 広告頻度の検証

**テストシナリオ**:
```
セッション1:
- レベル選択 → 練習画面（バナー表示）
- 診断1回目 → インタースティシャル表示
- 診断2回目 → インタースティシャル表示
- 診断3回目 → インタースティシャル表示

期待される広告表示:
- バナー: 1回（常時表示）
- インタースティシャル: 3回
```

**1日あたりの予想**:
```
アクティブユーザー: 1,000人
平均診断回数: 5回/ユーザー
総診断回数: 5,000回

バナー広告:
- インプレッション: 1,000回
- 収益: $0.50-$1.00

インタースティシャル広告:
- インプレッション: 5,000回
- 収益: $25.00-$50.00

合計予想収益: $25.50-$51.00/日
月間予想収益: $765-$1,530
```

#### 検証結果記録テンプレート

```markdown
## AdMob動作検証結果

### 日時: YYYY/MM/DD HH:MM

### バナー広告
- [ ] 表示成功
- [ ] 表示時間: ___秒
- [ ] レイアウト問題: なし / あり（詳細: ___）
- [ ] スクリーンショット: 添付

### インタースティシャル広告
- [ ] 表示成功
- [ ] 表示タイミング: 適切 / 不適切
- [ ] 診断処理との連携: 正常 / 問題あり
- [ ] 次回プリロード: 成功 / 失敗
- [ ] スクリーンショット: 添付

### 問題点
- 問題1: ___
- 対応: ___

### 総合評価
- [ ] 商用利用可能
- [ ] 要修正
```

---

### 2. 発音診断精度検証

#### 目的
AIスコアとフィードバックがレベル設定通りにパーソナライズされることを確認

#### テスト環境
- Pythonサーバー: 起動済み
- 参照音声: 生成済み
- テストユーザー: 初級/中級/上級の3パターン

#### 検証項目

##### 2.1 初級者の発音テスト（甘い評価）

**テストシナリオ**:
```
ユーザー設定: 初級（beginner）
テスト単語: "Maayong buntag"（おはよう）
発音品質: 中程度（スコア75-85点相当）
```

**期待される結果**:
```json
{
  "pronunciation_score": 80.0,
  "level": "beginner",
  "feedback": {
    "rating": "Excellent",  // 初級では80点でExcellent
    "overall": "Great job! Your pronunciation is very close to native.",
    "details": [
      {
        "aspect": "Pitch",
        "comment": "Your pitch is good!"
      }
    ],
    "tips": "Focus on listening to native speakers and repeating after them."
  }
}
```

**評価基準（初級）**:
- 75点以上: **Excellent** ✨
- 60-74点: Good
- 45-59点: Fair
- 45点未満: Needs Improvement

**確認ポイント**:
- ✅ 80点で「Excellent」評価
- ✅ ポジティブなフィードバック
- ✅ 初心者向けのアドバイス
- ✅ 励ましのトーン

##### 2.2 中級者の発音テスト（標準評価）

**テストシナリオ**:
```
ユーザー設定: 中級（intermediate）
テスト単語: "Pila ni?"（いくらですか）
発音品質: 中程度（スコア75-85点相当）
```

**期待される結果**:
```json
{
  "pronunciation_score": 80.0,
  "level": "intermediate",
  "feedback": {
    "rating": "Good",  // 中級では80点でGood
    "overall": "Good pronunciation! Keep practicing to improve further.",
    "details": [
      {
        "aspect": "Pitch",
        "comment": "Your pitch is good!"
      },
      {
        "aspect": "Timing",
        "comment": "Try to match the native speaker's pace."
      }
    ],
    "tips": "Pay attention to subtle sound differences and intonation patterns."
  }
}
```

**評価基準（中級）**:
- 85点以上: Excellent
- 70-84点: **Good** 👍
- 55-69点: Fair
- 55点未満: Needs Improvement

**確認ポイント**:
- ✅ 80点で「Good」評価（初級より厳しい）
- ✅ 具体的な改善点の指摘
- ✅ 中級者向けのアドバイス
- ✅ バランスの取れたフィードバック

##### 2.3 上級者の発音テスト（厳しい評価）

**テストシナリオ**:
```
ユーザー設定: 上級（advanced）
テスト単語: "Unsaon nako pag-adto sa Ayala?"
発音品質: 中程度（スコア75-85点相当）
```

**期待される結果**:
```json
{
  "pronunciation_score": 80.0,
  "level": "advanced",
  "feedback": {
    "rating": "Good",  // 上級では80点でもGood
    "overall": "Good pronunciation! Keep practicing to improve further.",
    "details": [
      {
        "aspect": "Pitch",
        "comment": "Your pitch is slightly higher than the reference. Try speaking a bit lower."
      },
      {
        "aspect": "Timing",
        "comment": "You're speaking a bit quickly. Try to slow down slightly."
      },
      {
        "aspect": "Volume",
        "comment": "Try speaking a bit louder for clearer pronunciation."
      }
    ],
    "tips": "Work on perfecting the nuances and natural flow of speech."
  }
}
```

**評価基準（上級）**:
- 90点以上: **Excellent** 🏆
- 80-89点: Good
- 65-79点: Fair
- 65点未満: Needs Improvement

**確認ポイント**:
- ✅ 80点で「Good」評価（Excellentには届かない）
- ✅ 細かい改善点の指摘
- ✅ 高度なアドバイス
- ✅ 厳しめのトーン

##### 2.4 レベル別比較テスト

**同じ発音品質（80点）での評価比較**:

| レベル | スコア | 評価 | フィードバックのトーン |
|--------|--------|------|----------------------|
| 初級 | 80点 | **Excellent** ✨ | 非常にポジティブ、励まし |
| 中級 | 80点 | **Good** 👍 | バランス、具体的改善点 |
| 上級 | 80点 | **Good** 📊 | 厳しめ、細かい指摘 |

**確認ポイント**:
- ✅ 同じスコアでもレベルによって評価が異なる
- ✅ フィードバックの詳細度が異なる
- ✅ アドバイスの高度さが異なる
- ✅ ユーザーのモチベーションを維持

#### 検証結果記録テンプレート

```markdown
## 発音診断精度検証結果

### 日時: YYYY/MM/DD HH:MM

### 初級者テスト
- 単語: ___
- スコア: ___点
- 評価: ___
- 期待評価: Excellent
- 結果: ✅ 合格 / ❌ 不合格
- フィードバック: ___

### 中級者テスト
- 単語: ___
- スコア: ___点
- 評価: ___
- 期待評価: Good
- 結果: ✅ 合格 / ❌ 不合格
- フィードバック: ___

### 上級者テスト
- 単語: ___
- スコア: ___点
- 評価: ___
- 期待評価: Good
- 結果: ✅ 合格 / ❌ 不合格
- フィードバック: ___

### レベル別パーソナライズ
- [ ] 初級: 甘い評価を確認
- [ ] 中級: 標準評価を確認
- [ ] 上級: 厳しい評価を確認
- [ ] フィードバックの差異を確認

### 問題点
- 問題1: ___
- 対応: ___

### 総合評価
- [ ] AI診断は商用利用可能
- [ ] 要調整
```

---

## 📊 商用利用可否判定基準

### AdMob動作
- ✅ バナー広告が100%表示される
- ✅ インタースティシャル広告が90%以上表示される
- ✅ 広告表示がUXを損なわない
- ✅ 収益予測が達成可能

### 発音診断精度
- ✅ レベル別評価基準が正しく機能
- ✅ 初級者が適切に励まされる
- ✅ 上級者が適切に挑戦される
- ✅ フィードバックが具体的で有用

### 総合判定
両方の項目で✅が80%以上 → **商用リリース可能** 🚀

---

## 🔧 トラブルシューティング

### AdMob関連

**問題**: バナー広告が表示されない
**原因**:
- インターネット接続の問題
- 広告ユニットIDの誤り
- AdMobアカウントの未承認

**対応**:
1. ネットワーク接続を確認
2. `AdManager.kt`の広告ユニットIDを確認
3. AdMobダッシュボードでアカウント状態を確認

**問題**: インタースティシャル広告が表示されない
**原因**:
- 広告のプリロードが完了していない
- 広告リクエストの頻度制限

**対応**:
1. アプリ起動時に広告をプリロード
2. 前回の広告表示から30秒以上経過していることを確認
3. ログで広告ロード状態を確認

### 診断精度関連

**問題**: すべてのレベルで同じ評価になる
**原因**:
- レベルパラメータがAPIに正しく送信されていない
- サーバー側のレベル判定ロジックの問題

**対応**:
1. `RecordingViewModel.kt`でレベルパラメータを確認
2. Pythonサーバーのログを確認
3. `audio_processor.py`の評価基準を確認

**問題**: スコアが常に同じ値になる
**原因**:
- 参照音声ファイルが存在しない
- DTW計算の問題

**対応**:
1. `reference_audio/`ディレクトリを確認
2. `generate_reference_audio.py`を実行
3. サーバーログでDTW計算を確認

---

## 📝 次のステップ

検証完了後:
1. ✅ 検証結果を記録
2. ✅ 問題点を修正
3. ✅ 再検証
4. ✅ リリース準備へ進む

リリース準備:
- [ ] Google Play Consoleアカウント作成
- [ ] アプリ署名鍵の生成
- [ ] プライバシーポリシーの作成
- [ ] ストアリスティングの準備
